require=function e(r,t,n){function i(a,s){if(!t[a]){if(!r[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(o)return o(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var l=t[a]={exports:{}};r[a][0].call(l.exports,function(e){var t=r[a][1][e];return i(t?t:e)},l,l.exports,e,r,t,n)}return t[a].exports}for(var o="function"==typeof require&&require,a=0;a<n.length;a++)i(n[a]);return i}({1:[function(e){(function(r){YUI.add("flickr-router",function(r){"use strict";function t(e,t,n){var i,o=this;return n.redirect?(window.location=n.redirect,r.Promise.resolve()):(document.title=n.title,r.loaderBar.progress(),e.appContext.getView(n.view,n.params,n.layout).then(function(t){return r.loaderBar.progress(),i=t,i._params&&(i._params.keyEventScope=i.name+i._yuid),e.appContext.getKeyboardManager().setCurrentKeyEventScope(i.name+i._yuid),i.set("isRootView",!0),i.initialize()}).then(function(){var t,a;r.loaderBar.progress(),t=r.one("html"),a=t.get("className").trim(),a=a.replace(/html-[\S]+-view/,"html-"+n.view),a=a.replace(/[\S]+-layout/,n.layout+"-layout"),a=a.replace("fluid",""),a+=n.fluid?" fluid":"",t.set("className",a),e.transactionId===o.currentTransactionId&&(o.app.showView(i,null,{render:!0,callback:function(){r.loaderBar.finish(),"popstate"!==e.src&&window.scroll(0,0)}}),r.Flog&&r.Flog.timeEnd("[Routing to Activation]"))}).then(null,function(e){throw r.Flog.fatal("Client render had an error:",e.message,e.stack),e}))}var n,i;i="scrolling",r.FlickrRouter=function(e,r){return this.app=e,this.route=e.route.bind(e),this.render=t.bind(this),this.setupRoutes(r),this},r.FlickrRouter.prototype={setupRoutes:function(e){var r,t,n,i,o;for(n in e.patterns)this.registerParam(n,new RegExp(e.patterns[n]));for(r=0;r<e.routes.length;r++)if(i=e.routes[r],i.path instanceof Array)for(t=0;t<i.path.length;t++){o={};for(n in i)"path"!==n&&(o[n]=i[n]);o.path=i.path[t],this.registerRoute(o)}else this.registerRoute(i)},registerParam:function(e,r){this.app.param(e,r)},registerRoute:function(t){var i=this;this.route(t.path,function(e,t,n){r.Flog&&r.Flog.time("[Routing to Activation]"),n()},function(e,r,t){"appContext"in window&&(e.appContext=window.appContext),t()},r.Middleware.MobileRedirect(t),e("lib/middleware/normalize-params-hash")(),e("lib/middleware/normalize-param")("nsid_or_path_alias"),e("lib/middleware/normalize-path-params")(),e("lib/middleware/set-route-config")(t),function(e,r,o){return n.bounceRoute(e,r,o,t,i)},function(e,r,i){return n.checkOptIn(e,r,i,t)},function(e,r,i){return n.checkAndKick(e,r,i,t)},function(e,r,i){return n.mixInServerRequest(e,r,i,t)},function(e,r,o){return n.checkAndInterstitial(e,r,o,t,i)},function(e,r,n){i._processRequest(t,e,r,n)})},_processRequest:function(e,t,n,i){var o=this;t.transactionId=r.guid(),this.currentTransactionId=t.transactionId,t.appContext.startTime=Date.now(),t.appContext.getRoute(e.module).then(function(e){var i,a;return o.executingRoute=e,i=r.when(null),a={id:t.id,isInsecureGod:t.isInsecureGod,cookies:t.cookies,headers:t.headers,params:t.params,url:t.url.toString(),query:t.query,buckets:t.buckets,lang:t.lang,probableUser:t.probableUser,UA:t.UA},t.isGod&&(a.isGod=t.isGod),t.routeTimingStart=Date.now(),r.Promise.all([i,e.run(a,n)])}).then(function(e){return e.length>=2&&(t.appContext.initialView=e[1].view),e[1].isMobile?(r.Flog.debug("[flickr-router] route is being processed as mobile."),e[1].params||(e[1].params={}),e[1].params.isMobile=!0):r.Flog.debug("[flickr-router] route is being processed as desktop."),o._renderView(e,t,n,i)}).then(null,function(e){return o._throwError.call(o,e,t,n,i)})},_renderView:function(e,t,n){var o,a=e.length>0?e[0]:null,s=e.length>1?e[1]:null;if(!s)throw new Error("Invalid viewConfig");if(a){if(a.signedIn&&a.user&&a.user.username?r.Flog.debug("[site auth]","["+a.user.nsid+"]",a.user.username._content+" is signed in."):r.Flog.debug("[site auth] user is signed out."),a.signedIn&&a.user)for(o in a.user)"undefined"==typeof YUI.Env.config.auth.whitelisted_keys[o]&&delete a.user[o];a.isInsecureGod=t.isInsecureGod,t.appContext.auth=a,t.appContext.initCuratorTools()}return s&&"undefined"!=typeof s.params&&(s.params.isOwner=t.appContext.getViewer().signedIn&&t.appContext.getViewer().nsid===s.params.nsid),s.redirect?this.render(t,n,s):(s.layout=s.layout||i,s.title=r.pageTitleHelper(s.title),t.appContext.routeTiming=Date.now()-t.routeTimingStart,this.render(t,n,s))},_throwError:function(e,t,n,i){var o,a,s=t&&t.UA&&(t.UA.isBot||t.UA.isSharingBot),u=s?r.fletrics.getBotString():"",c=this;if(n.headersSent)return r.Flog.debug("[flickr-router]","server render called but headers have already been sent","timeout="+(t.timeout?1:0)),void 0;try{if(r.fletrics.increment("page.failures"+u),r.Flog.error("[router] Reboot page failure",e.message,t.url),e.fatal?e.timeout||e.clientTimeout?(r.fletrics.increment("api.timeouts"+u),r.Flog.error("Unexpected error: api.timeouts"+u+" | Error: ",e.message)):(r.fletrics.increment("api.other"+u),r.Flog.error("Unexpected error: api.other"+u+" | Error: ",e.message)):(r.fletrics.increment("page.failures.other"+u),r.Flog.error("Unexpected error: page.failures.other | Error: ",e.message+" | isBot: "+s),r.config.win&&r.config.win.beaconError&&r.config.win.beaconError("[flickr-router] Unexpected page failure:"+e.message+" UA:"+(navigator&&navigator.userAgent||"").toString(),r.config.win.location.href,e)),r.config.win&&r.config.win.beaconError){e.panda=!0;var l="";t&&t.UA&&(l=" unsupported:"+t.UA.isUnsupportedBrowser+" ");var p=["undefined","Script error.","Script error","XHR error"];navigator.userAgent&&(void 0===typeof e.message||p.indexOf(e.message)>-1)&&(e.message=(e.message||"")+(navigator&&navigator.userAgent||"").toString()),r.config.win.beaconError("[flickr-router]"+l+e.message,r.config.win.location.href,e)}}catch(f){var d=f;"undefined"==typeof c.executingRoute&&(d=e),r.Flog.info(e,e.stack);try{if(r.config.win&&r.config.win.beaconError){e.panda=!0;var p=["undefined","Script error.","Script error","XHR error"];navigator.userAgent&&(void 0===typeof e.message||p.indexOf(e.message)>-1)&&(e.message=(e.message||"")+(navigator&&navigator.userAgent||"").toString()),r.config.win.beaconError("[flickr-router] _throwError failed: "+e.message,r.config.win.location.href,e),d!==e&&r.config.win.beaconError(d.message,r.config.win.location.href,d)}}catch(g){r.Flog.debug("Failed trying to beacon client error.")}}return o=c.executingRoute.display500Error(t,e),a=c.render(t,n,o)}},n={checkAndKick:function(e,r,t,n){t()},checkAndInterstitial:function(e,r,t){t()},bounceRoute:function(e,r,t,n,i){t()},checkOptIn:function(e,r,t,n){t()},mixInServerRequest:function(e,t,n){r.mix(e,r.namespace("config.flickr.request")),n()}}},"0.0.1",{requires:["fletrics","flog","oop","page-title-helper","moment","flickr-route","localizable","url","mobile-redirect"],langBundles:["misc"]})}).call(this,e("_process"))},{_process:6,"lib/middleware/normalize-param":2,"lib/middleware/normalize-params-hash":3,"lib/middleware/normalize-path-params":4,"lib/middleware/set-route-config":5}],2:[function(e,r){var t=e("lib/helpers/type-validator");r.exports=function(e){return function(r,n,i){var o=r.params[e];return o&&"string"==typeof o?(t.nsid(o)||(r.params[e]=String(o).toLowerCase()),i(),void 0):i()}}},{"lib/helpers/type-validator":"lib/helpers/type-validator"}],3:[function(e,r){r.exports=function(){return function(e,r,t){var n;for(n in e.params)e.params[n]=e.params[n][0];t()}}},{}],4:[function(e,r){r.exports=function(){return function(e,r,t){e.params instanceof Array&&e.params.shift(),t()}}},{}],5:[function(e,r){r.exports=function(e){return function(r,t,n){"object"==typeof r.appContext?(r.appContext.routeConfig=e,n()):n(new Error("appContext is undefined"))}}},{}],6:[function(e,r){function t(){c=!1,a.length?u=a.concat(u):l=-1,u.length&&n()}function n(){if(!c){var e=setTimeout(t);c=!0;for(var r=u.length;r;){for(a=u,u=[];++l<r;)a&&a[l].run();l=-1,r=u.length}a=null,c=!1,clearTimeout(e)}}function i(e,r){this.fun=e,this.array=r}function o(){}var a,s=r.exports={},u=[],c=!1,l=-1;s.nextTick=function(e){var r=new Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)r[t-1]=arguments[t];u.push(new i(e,r)),1!==u.length||c||setTimeout(n,0)},i.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=o,s.addListener=o,s.once=o,s.off=o,s.removeListener=o,s.removeAllListeners=o,s.emit=o,s.binding=function(){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(){throw new Error("process.chdir is not supported")},s.umask=function(){return 0}},{}],"lib/helpers/type-validator":[function(e,r,t){function n(e){return function(r){return e.test(r)}}t.nsid=n(/^[0-9]+@N[0-9]+$/),t.pathAlias=n(/^[0-9a-zA-Z-_]+$/),t.photoId=n(/^[0-9]+$/),t.bookId=n(/^[0-9]+$/),t.orderId=n(/^[0-9]+$/)},{}]},{},[1]);