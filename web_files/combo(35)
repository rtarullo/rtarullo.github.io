YUI.add("fluid-share-photostream-view",function(e,t){e.FlickrView.create(this.name,e.namespace("Views")["fluid-share-view"],[],{langBundles:this.details.langBundles,subClassName:t,initializer:function(e){return this.nsid=e.nsid,this.constructor.superclass.buildContainer.call(this,{extraShareButtonClassList:"share-photostream-icon",sharingDisabled:!0,shareTooltip:this.intlMessage({intlName:"share-modal.SHARE_PHOTOSTREAM"})}),this.constructor.superclass.initializer.call(this,e)},loadState:function(){return this.isEnglishLang?e.Promise.resolve():this.loadRequiredModels()},getItemCount:function(){return this.isEnglishLang?this.loadRequiredModels():e.Promise.resolve(1)},loadRequiredModels:function(){var t=this,n=1;return e.Promise.all([this.appContext.getModel("photostream-models",this.nsid+"-"+n,{privacyFilter:n,perPage:5,page:1}),this.appContext.getModelRegistry("photostream-models")]).then(function(e){t.set("photostreamModel",e[0]),t.isDisabled=t.appContext.getViewer().nsid!==t.nsid&&parseInt(e[0].getValue("totalItems"),10)<1,t.set("photos",e[0].getValue("photoPageList").getList()),t.appContext.getViewer().nsid===t.nsid&&e[1].exists(t.nsid)&&(t.isDisabled=t.isDisabled||parseInt(e[1].getValue(t.nsid,"totalItems"),10)<1)})},buildContainer:function(){return this.constructor.superclass.buildContainer.call(this,{extraShareButtonClassList:"share-photostream-icon",sharingDisabled:this.isDisabled,shareTooltip:this.intlMessage({intlName:"share-modal.SHARE_PHOTOSTREAM"})}),this},prepareFacebookShareParameters:function(){return{url:this.get("photostreamModel").getValue("url")}},prepareTwitterShareParameters:function(){var t=this.get("photostreamModel");return{url:e.URLHelper.getShortPhotostreamURL(t.getValue("normalizedId")),title:this.intlMessage({intlName:"models.USER_PHOTOSTREAM",name:t.getValue("owner").getValue("displayname")})}},prepareTumblrShareParameters:function(){var e=this.get("photostreamModel"),t=e.getValue("owner");return{title:this.intlMessage({intlName:"models.USER_PHOTOSTREAM",name:t.getValue("displayname")}),authorURL:t.getValue("url"),url:e.getValue("url"),displayPhotoURL:this.get("photos").map(function(e){return e.getLargestSize().url}),tags:"Flickr"}},preparePinterestShareParameters:function(){var t=this.get("photostreamModel"),n=t.getValue("owner");return{title:this.intlMessage({intlName:"models.USER_PHOTOSTREAM",name:n.getValue("displayname")}),displayPhotoURL:this.get("photos").length>0?this.get("photos")[0].getLargestSize().url:null,shortURL:e.URLHelper.getShortPhotostreamURL(t.getValue("normalizedId")),url:t.getValue("url"),count:1}},prepareFlickrShareParameters:function(){var e=this.get("photostreamModel"),t=e.getValue("owner");return{title:this.intlMessage({intlName:"models.USER_PHOTOSTREAM",name:t.getValue("displayname")}),modelName:"photostream",modelId:this.nsid,url:e.getValue("url"),count:1}},prepareLinkShareParameters:function(){var t=this.get("photostreamModel");return{url:t.getValue("url"),author:t.getValue("owner").getValue("displayname"),authorURL:t.getValue("owner").getValue("url"),shortURL:e.URLHelper.getShortPhotostreamURL(t.getValue("normalizedId")),supportsEmbedr:!1,supportsBBCode:!1,privacyWarningString:this.intlMessage({intlName:"share-modal.PHOTOSTREAM_PRIVACY_WARNING",photoCount:t.getValue("totalItems")})}},getTitleIntlKey:function(){return"SHARE_PHOTOSTREAM_TO"},getGuestPassParams:function(){var e=this.appContext.getViewer().nsid;return{type:"photostream",id:this.nsid,contentMarkedFriends:this.nsid===e,contentMarkedFamily:this.nsid===e,contentMarkedFriendFamily:this.nsid===e,contentMarkedPublic:!0,canSharePrivate:!1,showGuestPassDropdown:!0,multipleItems:!0}},getIsMine:function(){return this.get("photostreamModel").getValue("isOwner")}})},"@VERSION@",{requires:["flickr-view","flickr-promise","fluid-share-view","url-helper"],langBundles:["models"]});
YUI.add("fluid-share-favorites-view",function(e,t){e.FlickrView.create(this.name,e.namespace("Views")["fluid-share-view"],[],{langBundles:this.details.langBundles,subClassName:t,initializer:function(e){return this.nsid=e.nsid,this.constructor.superclass.buildContainer.call(this,{extraShareButtonClassList:"share-favorites-icon",sharingDisabled:!0,shareTooltip:this.intlMessage({intlName:"share-modal.SHARE_FAVORITES"})}),this.constructor.superclass.initializer.call(this,e)},loadState:function(){return this.isEnglishLang?e.Promise.resolve():this.loadRequiredModels()},getItemCount:function(){return this.isEnglishLang?this.loadRequiredModels():e.Promise.resolve(1)},loadRequiredModels:function(){var t=this,n=1;return e.Promise.all([this.appContext.getModel("favorite-models",this.nsid+"-"+n,{privacyFilter:n,perPage:5,page:1}),this.appContext.getModelRegistry("favorite-models")]).then(function(e){t.set("favoriteModel",e[0]),t.isDisabled=t.appContext.getViewer().nsid!==t.nsid&&parseInt(e[0].getValue("totalItems"),10)<1,t.set("photos",e[0].getValue("photoPageList").getList()),t.appContext.getViewer().nsid===t.nsid&&e[1].exists(t.nsid)&&(t.isDisabled=t.isDisabled||parseInt(e[1].getValue(t.nsid,"totalItems"),10)<1)})},buildContainer:function(){return this.constructor.superclass.buildContainer.call(this,{extraShareButtonClassList:"share-favorites-icon",sharingDisabled:this.isDisabled,shareTooltip:this.intlMessage({intlName:"share-modal.SHARE_FAVORITES"})}),this},prepareFacebookShareParameters:function(){return{url:this.get("favoriteModel").getValue("url")}},prepareTwitterShareParameters:function(){var t=this.get("favoriteModel");return{url:e.URLHelper.getShortFavoritesURL(t.getValue("normalizedId")),title:this.intlMessage({intlName:"models.USER_FAVORITES",name:t.getValue("owner").getValue("displayname")})}},prepareTumblrShareParameters:function(){var e=this.get("favoriteModel"),t=e.getValue("owner");return{title:this.intlMessage({intlName:"models.USER_FAVORITES",name:t.getValue("displayname")}),authorURL:e.getValue("url"),url:e.getValue("url"),displayPhotoURL:this.get("photos").map(function(e){return e.getLargestSize().url}),tags:"Flickr"}},preparePinterestShareParameters:function(){var t=this.get("favoriteModel"),n=t.getValue("owner");return{title:this.intlMessage({intlName:"models.USER_FAVORITES",name:n.getValue("displayname")}),displayPhotoURL:this.get("photos").length>0?this.get("photos")[0].getLargestSize().url:null,shortURL:e.URLHelper.getShortFavoritesURL(t.getValue("normalizedId")),url:t.getValue("url"),count:1}},prepareFlickrShareParameters:function(){var e=this.get("favoriteModel"),t=e.getValue("owner");return{title:this.intlMessage({intlName:"models.USER_FAVORITES",name:t.getValue("displayname")}),modelName:"favorites",modelId:this.nsid,url:e.getValue("url"),count:1}},prepareLinkShareParameters:function(){var t=this.get("favoriteModel");return{url:t.getValue("url"),author:t.getValue("owner").getValue("displayname"),authorURL:t.getValue("owner").getValue("url"),shortURL:e.URLHelper.getShortFavoritesURL(t.getValue("normalizedId")),supportsEmbedr:!1,supportsBBCode:!1}},getTitleIntlKey:function(){return"SHARE_FAVES_TO"},getIsMine:function(){return this.get("favoriteModel").getValue("isOwner")},getGuestPassParams:function(){return{contentMarkedFriends:!1,contentMarkedFamily:!1,contentMarkedPublic:!0,canSharePrivate:!1,showGuestPassDropdown:!1,multipleItems:!0}}})},"@VERSION@",{requires:["flickr-view","flickr-promise","fluid-share-view","url-helper"],langBundles:["models"]});
YUI.add("hermes-template-fluid-magic-slideshow",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function c(e,t){return" disabled"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a=this,f=n.helperMissing,l=this.escapeExpression;s+='<a href="#" class="slideshow-toggle',o=n.unless.call(t,t.isEnabled,{hash:{},inverse:a.noop,fn:a.program(1,c,i),data:i});if(o||o===0)s+=o;return s+='" title="',u={hash:{intlName:"common.TOGGLE_SLIDESHOW"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,u):f.call(t,"intlMessage",u)))+'"><span></span></a>\n',s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/fluid-magic-slideshow",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-slideshow",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function p(e,t){return" no-click"}function d(e,t){return" is-hidden"}function v(e,t){return" is-video"}function m(e,t){var r;return(r=n["prev-url"])?r=r.call(e,{hash:{},data:t}):(r=e["prev-url"],r=typeof r===f?r.apply(e):r),l(r)}function g(e,t){return"#"}function y(e,t){var r;return(r=n["next-url"])?r=r.call(e,{hash:{},data:t}):(r=e["next-url"],r=typeof r===f?r.apply(e):r),l(r)}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f="function",l=this.escapeExpression,c=n.helperMissing,h=this;a={hash:{},data:i},s+=l((o=n.outlet||t.outlet,o?o.call(t,t["photo-well-view"],a):c.call(t,"outlet",t["photo-well-view"],a)))+'\n<a class="playpause chrome" data-track="playpauseClick"><span class="pause-button"></span><span class="play-button"></span><div class="timer"></div></a>\n\n<a class="navigate-target chrome navigate-prev',u=n["if"].call(t,t["prev-is-not-clickable"],{hash:{},inverse:h.noop,fn:h.program(1,p,i),data:i});if(u||u===0)s+=u;u=n["if"].call(t,t["is-hidden"],{hash:{},inverse:h.noop,fn:h.program(3,d,i),data:i});if(u||u===0)s+=u;u=n["if"].call(t,t["is-video"],{hash:{},inverse:h.noop,fn:h.program(5,v,i),data:i});if(u||u===0)s+=u;s+='" href="',u=n["if"].call(t,t["prev-url"],{hash:{},inverse:h.program(9,g,i),fn:h.program(7,m,i),data:i});if(u||u===0)s+=u;s+='" data-track="prevPhotoButtonClick" data-direction="prev"><span class="navigate-target-arrow"></span></a>\n\n<a class="navigate-target chrome navigate-next',u=n["if"].call(t,t["next-is-not-clickable"],{hash:{},inverse:h.noop,fn:h.program(1,p,i),data:i});if(u||u===0)s+=u;u=n["if"].call(t,t["is-hidden"],{hash:{},inverse:h.noop,fn:h.program(3,d,i),data:i});if(u||u===0)s+=u;u=n["if"].call(t,t["is-video"],{hash:{},inverse:h.noop,fn:h.program(5,v,i),data:i});if(u||u===0)s+=u;s+='" href="',u=n["if"].call(t,t["next-url"],{hash:{},inverse:h.program(9,g,i),fn:h.program(11,y,i),data:i});if(u||u===0)s+=u;return s+='" data-track="nextPhotoButtonClick" data-direction="next"><span class="navigate-target-arrow"></span></a>\n\n<a class="close chrome" data-track="closeClick"><span></span></a>\n',a={hash:{},data:i},s+=l((o=n.outlet||t.outlet,o?o.call(t,t["slideshow-attribution-view"],a):c.call(t,"outlet",t["slideshow-attribution-view"],a)))+"\n",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/slideshow",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("slideshow-attribution-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{initializer:function(e){this.set("isActiveViewAgnostic",e.isActiveViewAgnostic);var t=e.collection.getList()[e.position];return t&&(this.nsid=e.nsid=t.getValue("owner").getValue("nsid")),this.realFullscreen=!0,this},langBundles:this.details.langBundles,subviewConfig:{"follow-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,isActiveViewAgnostic:!0,isFluid:!0,isOnDark:!0}},loadState:function(){var e=this;if(this.nsid)return this.appContext.getModel("person-models",this.nsid).then(function(t){e.set("owner",t)});throw new Error("missing nsid")},buildContainer:function(){var e=this.get("owner"),t=this.appContext.getViewer().nsid,n=e.getValue("pathAlias")||e.getValue("nsid"),r,i;return i=e.getValue("buddyicon").large?e.getValue("buddyicon").large:e.getValue("buddyicon")["default"],r=this.templates("attribution")({pathAlias:n,buddyicon:i,nsid:e.getValue("nsid"),noMenu:!0,displayname:e.getValue("displayname"),follow:this.subviews["follow-view"]?this.subviews["follow-view"].get("container"):"",realFullscreenEnabled:this.realFullscreen&&this.appContext.experiments.fullscreen.getMode()}),this.setContainerHTML(r),t===e.getValue("nsid")&&this.get("container").addClass("is-self"),this},activate:function(){return this.registerEventHandler(e.on("personMenuOpen",this.handlePersonMenuOpen.bind(this))),this.registerEventHandler(e.on("personMenuClose",this.handlePersonMenuClose.bind(this))),this},handlePersonMenuOpen:function(e){this.fire("subviewViewEvent","personMenuOpen")},handlePersonMenuClose:function(e){this.fire("subviewViewEvent","personMenuClose")},onParentViewEvent:function(t,n){var r,i=this,s;n&&n[0]&&(r=n[0],r==="slideshowView:newPhoto"?n[1]&&(s=n[1].getValue("owner").getValue("nsid"),s!==this.nsid&&(this.nsid=s,this.set("owner",n[1].getValue("owner")),this.subviews["follow-view"].destroy({remove:!0}),this.instantiateSubview("follow-view",{nsid:s,realFullscreen:!0,isActiveViewAgnostic:!0,isFluid:!0,isOnDark:!0}).then(function(e){return e.initialize()}).then(function(e){i.buildContainer(),i.get("container").one(".follow-view").addClass("is-real-fullscreen photo-attribution"),e.normalizedActivate()}).catch(function(t){e.Flog.error("[slideshow-attribution-view] Error loading follow-view: ",t)}))):r==="slideshowView:preloadPhoto"&&(s=n[1].getValue("owner").getValue("nsid"),s!==this.nsid&&i.appContext.getModel("person-relationship-models",{id:s})))}})},"@VERSION@",{requires:["flickr-view","hermes-template-attribution"],optional:["person-models"],langBundles:["attribution"]});
YUI.add("slideshow-well-view",function(e){var t=500,n=500;e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){var t=e.collection.getList()[e.position];if(!t)throw new Error("missing photo");return this.set("photo",t),this.set("isActiveViewAgnostic",!0),this.set("canvasSizeIsDirty",!0),this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this},buildContainer:function(){var t=this,n,r=this.get("photo"),i,s;return t.preloadImage&&(t.preloadImage.onload=null),this.appContext.forceServerRender?(i=this.getPhotoForDisplay(r,{canvas:{width:Number.MAX_VALUE,height:Number.MAX_VALUE}}),s=i):(i=this.getPhotoForDisplay(r),s=this.getPhotoForDisplay(r,{includeSizes:["sq","q","t","s","n"]})),n=this.templates("photo-well-media-scrappy")({width:i.width,height:i.height,src:s.url,highResSrc:i.url,showFuzzy:r.getValue("needsInterstitial"),isSignedIn:this.appContext.getViewer().signedIn,isVideo:!1}),this.setContainerHTML(n),YUI.Env.isServer?(this.serverWidth=i.width,this.serverHeight=i.height):r.getValue("needsInterstitial")||this.preloadPhoto(r).then(function(){var e=t.get("container").one(".low-res-photo"),n=t.get("container").one(".main-photo");n&&n.removeClass("is-hidden").show(),e&&e.hide()}).catch(function(t){e.Flog.error("[slideshow-well-view] Error building slideshow: ",t)}),this},preloadPhoto:function(t){var n=this;return new e.Promise(function(e,r){return n.generatePhotoElement(t,e,r)})},generateFuzzyElement:function(e){var t,n;return t=this.getPhotoForDisplay(e),n=document.createElement("span"),n.style.width=t.width+"px",n.style.height=t.height+"px",n},generatePhotoElement:function(t,n,r){var i,s;return i=this.getPhotoForDisplay(t),s=new Image,s.src=i.url,s.width=i.width,s.height=i.height,s.complete&&n&&typeof n=="function"&&n(t),s=e.one(s),n&&typeof n=="function"&&s.once("load",function(){n(t),s.detachAll(),s=undefined}),r&&typeof r=="function"&&s.once("error",function(){r(t),s.detachAll(),s=undefined}),s},handlePhotoLoaded:function(e){this.fire("subviewViewEvent","photoLoaded"),e.getValue("isOwner")||this.appContext.getViewCounter().queue(e.getValue("id"),this.appContext.getReferrer())},swapPhoto:function(t,n){var r,i,s;s=this.get("container").one(".restricted-image"),s&&(i=!0),t.getValue("needsInterstitial")?(r=this.generateFuzzyElement(t),r.className="main-photo outro restricted-image",r=e.one(r),s=this.get("container").one(".main-photo"),n||(s.once("transitionend",function(){s.detach(),s&&s.remove(!0),s=undefined}),s.removeClass("main-photo"),s.removeClass("intro"),s.addClass("outro"),r.removeClass("outro"),r.addClass("intro")),s.insert(r,"before"),n&&(r.removeClass("outro"),s.remove(!0)),this.fire("subviewViewEvent","photoLoaded")):(r=this.generatePhotoElement(t,this.handlePhotoLoaded.bind(this)),i||(s=this.get("container").one(".main-photo")),r.addClass("main-photo"),r.addClass("outro"),s&&s.removeClass("main-photo"),n?(r&&r.removeClass("outro"),s&&(s.insert(r,"before"),s.remove(!0))):(s&&(s.once("transitionend",function(){s.detachAll(),s&&s.remove(!0),s=undefined}),s.addClass("outro"),s.removeClass("intro"),s.insert(r,"before")),r&&(r.removeClass("outro"),r.addClass("intro"))))},onParentViewEvent:function(e,t){var n;if(t&&t[0]){n=t[0];switch(n){case"photoWellResized":this.get("photo").getValue("needsInterstitial")||this.buildContainer();break;case"slideshowView:newPhoto":t[1]&&(this.set("photo",t[1]),this.swapPhoto(t[1],t[2]));break;case"slideshowView:preloadPhoto":t[1]&&this.preloadPhoto(t[1]);break;default:}}},activate:function(){var t=this;return this.get("photo").getValue("needsInterstitial")||(this.registerEventHandler(e.on("flickr:photo-media-well-update",function(e){t.buildContainer()})),e.use("global-events",function(e){t.registerEventHandler(e.globalEvents.subscribe("window:resize",function(e){t.buildContainer()}))})),this.appContext.getViewer().signedIn&&this.appContext.getModel("person-preferences-models",t.appContext.auth.user.nsid).then(function(e){t.set("personPreferences",e),t.get("photo").getValue("needsInterstitial")&&t.registerEventHandler(t.get("container").one(".restricted-interstitial-message button").on("click",t.handleInterstitialDismissButtonClick,t))}),this},getPhotoForDisplay:function(e,t){var n=this.getCanvasSize(),r=this.getPixelRatio(),i,s,o,u=!0;return t&&t.canvasSize&&(n=t.canvasSize),i=e.getSizeToFit(n,t),s=n.height/r,u||(s=Math.min(s,i.height)),o=Math.min(n.width/r,i.width/i.height*s),s=Math.min(s,i.height/i.width*o),{width:Math.round(o),height:Math.round(s),url:i.url,pixelRatio:i.width/o}},getCanvasSize:function(){var r,i=this.getPixelRatio(),s,o={width:t,height:n};return this.get("canvasSizeIsDirty")?YUI.Env.isServer||(s=e.one("#content"),s&&(r=s.get("region"),r.height=e.config.win.innerHeight,r.width=e.config.win.innerWidth)):r=this.get("cachedCanvasSize"),this.appContext.viewportData.viewport.width>0&&(o={width:this.appContext.viewportData.viewport.width,height:this.appContext.viewportData.viewport.height-240}),r||(r={top:0,left:0,bottom:n,right:t,width:o.width,height:o.height}),r.height*=i,r.width*=i,r},getPixelRatio:function(){return this.appContext.getViewer().getPixelRatio()}},{})},"@VERSION@",{requires:["flickr-view","hermes-template-photo-well-media-scrappy"],langBundles:["common","photo-page-scrappy"]});
YUI.add("slideshow-view",function(e){e.namespace("Views").Slideshow=e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){this.set("isActiveViewAgnostic",!0),this.collection=e.collection,this.pageParams=e.pageParams||{perPage:20},this.pageParams.page=parseInt(e.pageNumber,10)||1,this.position=parseInt(e.position,10)||0;if(this.collection.totalItems<1)throw new Error("no items in collection");return this.get("container").getHTML()===""&&this.setContainerHTML(this.templates("flickr-balls")({})),this},subviewConfig:{"slideshow-attribution-view":{isActiveViewAgnostic:!0,requiredToShowOnClient:!1,requiredToShowOnServer:!1,additionalViewClasses:["is-real-fullscreen","photo-attribution","chrome"]},"slideshow-well-view":{isActiveViewAgnostic:!0,requiredToShowOnClient:!1,requiredToShowOnServer:!1,dealbreaker:!0}},loadState:function(){var t=this;return this.collection.getPage(this.pageParams).then(function(){var n=t.collection.getList(),r,i,s,o;o=n[t.position];if(!o)throw new Error("The starting photo does not exist.");r=parseInt(t.collection.totalItems,10),t.bufferPhotos(t.position,t.get("bufferSize")),i=r-1,s=t.position-1,s<0&&(s=i);if(!n[s])return t.pageParams.page=Math.ceil(s/t.pageParams.perPage),t.collection.getPage(t.pageParams).then(function(){t.bufferPhotos(t.position,t.get("bufferSize"),"prev")}).catch(function(t){e.Flog.error("[slideshow-view] Error fetching next page in collection: ",t)})}).catch(function(n){e.Flog.error("[slideshow-view] Error initializing slideshow: ",n),t.close()})},buildContainer:function(){var e,t;return this.subviews["slideshow-attribution-view"]&&(t=this.subviews["slideshow-attribution-view"].get("container")),e=this.templates("slideshow")({"slideshow-attribution-view":t,"photo-well-view":this.subviews["slideshow-well-view"].get("container")}),this.setContainerHTML(e),this},freeze:function(){e.one("body").setStyles({overflow:"hidden"})},unfreeze:function(){e.one("body").setStyles({overflow:"visible"})},show:function(){var t=this,n=e.one("#content");if(!n){e.Flog.error("[slideshow-view] Error initializing slideshow: missing content div");return}n.append(this.get("container")),this.get("enableFullscreen")&&(this.fullScreenManager=new e.fluid.Fullscreen,this.fullScreenManager.on("enterFullscreen",this.finishInitialization.bind(this)),this.fullScreenManager.enterFullscreen());try{this.initialize().then(function(){t.finishInitialization()}).catch(function(n){e.Flog.error("[slideshow-view] Error initializing slideshow: ",n),t.close()})}catch(r){e.Flog.error("[slideshow-view] Error initializing slideshow: ",r),t.close()}return e.fire("flickr:setKeyEventScope",this.getKeyEventScope()),this.freeze(),this},close:function(t){var n=this.get("container");e.fire("flickr:removeKeyEventScope",this.getKeyEventScope()),this.get("enableFullscreen")&&(this.fullScreenManager.exitFullscreen(),this.fullScreenManager.destroy()),n&&n.remove(!0),this.unfreeze(),this.fire("close",t),clearTimeout(this.mouseMoveTimer),clearTimeout(this.initialFadeTimer),clearTimeout(this.timer),clearTimeout(this.movingFadeTimer),this.destroy({remove:!0})},removeCircleTimer:function(){var t=e.d3.select(".timer > svg");t=t.remove()},drawCircleTimer:function(){var t,n,r,i=2,s=35,o=40,u={},a=this.get("autoplayInterval"),f=".timer",l=this.get("container").one(f),c;u.width=l.get("clientWidth"),u.height=l.get("clientHeight"),t=e.d3.svg.arc().innerRadius(s).outerRadius(o),n=e.d3.scale.linear().range([0,360]).domain([0,360]),r=e.d3.range(n(360)).map(function(e,t){return t*=i,{startAngle:t*(Math.PI/360),endAngle:(t+2)*(Math.PI/360)}}),c=e.d3.select(f).append("svg").attr("class","arc-timer").attr("width",u.width).attr("height",u.height).append("g").attr("transform","translate("+u.width/2+", "+u.height/2+")"),c.append("g").selectAll("path").data(r).enter().append("path").attr("fill",function(e){return"#fff"}).transition().delay(function(e,t){return t*a/r.length}).duration(a/r.length).ease("linear").attrTween("d",function(n){var r=e.d3.interpolate(n.startAngle,n.endAngle);return function(e){return n.endAngle=r(e),t(n)}})},getNextSafePhoto:function(e,t){var n,r,i;n=this.collection.getList(),r=parseInt(this.collection.totalItems,10),t=t||"next";if(t==="next"){e+=1;if(e===r){if(!this.collection.fetchedEnd)return;e=0}}else{e-=1;if(e===-1){if(!this.collection.fetchedEnd)return;e=r-1}}return i=n[e],i?e:e===this.position?-1:this.getNextSafePhoto(e,t)},handlePhotoChange:function(t,n){var r,i,s,o,u,a;r=this.collection.getList(),u=parseInt(this.collection.totalItems,10),s=u-1,t=t||"next",o=this.getNextSafePhoto(this.position,t),o>-1&&(this.position=o),t==="next"?(i=this.position+this.pageParams.perPage,i>s&&(i-=s)):(i=this.position-this.pageParams.perPage,i<0&&(i=s)),a=r[this.position],this.fire("parentViewEvent","slideshowView:newPhoto",a,n),r[i]||(this.pageParams.page=Math.ceil(i/this.pageParams.perPage),this.collection.getPage(this.pageParams).catch(function(t){e.Flog.error("[slideshow-view] Error fetching next page in collection: ",t)})),this.bufferPhotos(this.position,this.get("bufferSize"),t)},bufferPhotos:function(e,t,n){var r,i,s;s=this.collection.getList(),i=parseInt(this.collection.totalItems,10),n=n||"next";if(t>0){n==="next"?(e+=1,e===i&&(e=0)):(e-=1,e<0&&(e=i-1)),r=s[e];if(r)return this.fire("parentViewEvent","slideshowView:preloadPhoto",r),t-=1,this.bufferPhotos(e,t,n)}return},handleKeys:function(t){var n=t.button;n===37||n===74?(e.rapidTracker.beacon(this.name,"keyboardLeft"),t.halt(),this.handleNavigation("prev",!0)):n===39||n===75||n===13?(e.rapidTracker.beacon(this.name,"keyboardRight"),t.halt(),this.handleNavigation("next",!0)):n===32?(e.rapidTracker.beacon(this.name,"keyboardPause"),t.halt(),this.handlePlayPause(this.get("container").one(".playpause"))):n===27?(e.rapidTracker.beacon(this.name,"keyboardEsc"),t.halt(),this.close()):t.halt()},handleNavigation:function(e,t){this.handlePhotoChange(e,t),clearTimeout(this.movingFadeTimer),this.movingFadeTimer=setTimeout
(this.handleMouseIdle.bind(this),this.get("fadeTimer"))},handlePlayPause:function(e){this.showChrome(),this.toggleAutoplay()},handleClick:function(t){var n=t.target,r;n.hasClass("navigate-target")?(e.rapidTracker.beacon(this.name,"mouseNav"),t.halt(),r=n.getData("direction"),this.handleNavigation(r,!0)):n.hasClass("playpause")?(e.rapidTracker.beacon(this.name,"mousePlayPause"),t.halt(),this.handlePlayPause(n)):n.hasClass("close")&&(e.rapidTracker.beacon(this.name,"mouseClose"),t.halt(),this.close())},getKeyEventScope:function(){return this.name+this._yuid},cycle:function(){clearTimeout(this.timer),this.removeCircleTimer(),this.timer=setTimeout(this.handlePhotoChange.bind(this),this.get("autoplayInterval")),this.drawCircleTimer()},pauseAutoplay:function(){var t=this.get("container").one(".playpause");e.rapidTracker.beacon(this.name,"pauseAutoplay"),clearTimeout(this.timer),this.isPlaying=!1,this.removeCircleTimer(),t.removeClass("playing"),t.addClass("paused")},startAutoplay:function(){var t=this.get("container").one(".playpause");e.rapidTracker.beacon(this.name,"startAutoplay"),this.isPlaying=!0,this.cycle(),t.removeClass("paused"),t.addClass("playing")},toggleAutoplay:function(){this.isPlaying?this.pauseAutoplay():this.startAutoplay()},showChrome:function(){clearTimeout(this.movingFadeTimer),this.isShowingChrome=!0,this.movingFadeTimer=setTimeout(this.handleMouseIdle.bind(this),this.get("fadeTimer")),this.get("container").removeClass("idle")},handleMouseMove:function(e){var t;if(this.isShowingChrome){this.startPoint={x:e.pageX,y:e.pageY},clearTimeout(this.movingFadeTimer),this.movingFadeTimer=setTimeout(this.handleMouseIdle.bind(this),this.get("fadeTimer"));return}this.startPoint?(clearTimeout(this.mouseMoveTimer),clearTimeout(this.initialFadeTimer),t=Math.round(Math.sqrt(Math.pow(this.startPoint.y-e.pageY,2)+Math.pow(this.startPoint.x-e.pageX,2))),t>this.get("chromeTriggerRadius")&&this.showChrome(),this.mouseMoveTimer=setTimeout(this.resetMouseDistance.bind(this),this.get("mouseIdleTimer"))):this.startPoint={x:e.pageX,y:e.pageY}},resetMouseDistance:function(){this.startPoint=null},handleMouseIdle:function(){var t;if(this.startPoint){t=e.one(document.elementFromPoint(this.startPoint.x,this.startPoint.y));if(t&&t.ancestor(function(e){return e.hasClass("chrome")},!0)){this.movingFadeTimer=setTimeout(this.handleMouseIdle.bind(this),this.get("fadeTimer"));return}}this.hideChrome()},hideChrome:function(){this.resetMouseDistance(),this.get("container").addClass("idle"),this.isShowingChrome=!1,clearTimeout(this.movingFadeTimer)},onSubviewEvent:function(e,t){e==="slideshow-well-view"&&t[0]==="photoLoaded"?this.isPlaying&&this.cycle():e!=="slideshow-attribution-view"||t[0]!=="isOpen"&&t[0]!=="personMenuOpen"?e==="slideshow-attribution-view"&&(t[0]==="isClosed"||t[0]==="personMenuClose")&&(this.movingFadeTimer=setTimeout(this.handleMouseIdle.bind(this),this.get("fadeTimer"))):(clearTimeout(this.movingFadeTimer),clearTimeout(this.initialFadeTimer),this.pauseAutoplay())},finishInitialization:function(){!this.finished&&this.get("enableFullscreen")&&this.fullScreenManager.isInFullscreenMode()?this.finished=!0:(this.get("autoplay")&&this.startAutoplay(),this.initialFadeTimer=setTimeout(this.hideChrome.bind(this),1500))},activate:function(){var t=this.get("container");return this.registerEventHandler(t.on("click",this.handleClick,this)),this.registerEventHandler(this.appContext.flapp.before("activeViewChange",this.close.bind(this))),this._params&&(this._params.keyEventScope=this.getKeyEventScope()),this.attachKeyEvent("down:8,13,27,32,37,74,39,75",e.betterThrottle(this.handleKeys.bind(this),100)),this.get("enableFullscreen")&&this.registerEventHandler(this.fullScreenManager.on("exitFullscreen",this.close.bind(this))),this.registerEventHandler(e.one("body").on("mousemove",e.betterThrottle(this.handleMouseMove.bind(this)))),this}},{ATTRS:{autoplay:{value:!0},autoplayInterval:{value:5e3},fadeTimer:{value:2e3},mouseIdleTimer:{value:200},chromeTriggerRadius:{value:30},bufferSize:{value:2},enableFullscreen:{value:!0}}})},"@VERSION@",{requires:["flickr-view","hermes-template-slideshow","slideshow-attribution-view","slideshow-well-view","slideshow-css","fluid-balls-css"],optionalRequires:["d3","fluid-fullscreen"],langBundles:["common","photo-page-scrappy"]});
YUI.add("fluid-fullscreen",function(e){"use strict";function t(){this.fullscreenChangeHandler.detach(),this.webkitFullscreenChangeHandler.detach(),this.mozFullscreenChangeHandler.detach(),this.msFullscreenChangeHandler.detach()}function n(){this.isInFullscreenMode()?this.fire("enterFullscreen"):this.fire("exitFullscreen")}function r(){var t=e.config.doc;return t.fullscreenEnabled||t.webkitFullscreenEnabled||t.mozFullScreenEnabled||t.msFullscreenEnabled}function i(t){var n=e.config.doc,i=n.documentElement;t&&(i=t.getDOMNode());if(r()){if(i.requestFullscreen)return i.requestFullscreen();if(i.webkitRequestFullscreen)return i.webkitRequestFullscreen();if(i.mozRequestFullScreen)return i.mozRequestFullScreen();if(i.msRequestFullscreen)return i.msRequestFullscreen()}return!1}function s(){var t=e.config.doc;return t.fullscreenElement||t.webkitFullscreenElement||t.mozFullScreenElement||t.msFullscreenElement}function o(){var t=e.config.doc;if(s()){if(t.exitFullscreen)return t.exitFullscreen();if(t.webkitExitFullscreen)return t.webkitExitFullscreen();if(t.mozCancelFullScreen)return t.mozCancelFullScreen();if(t.msExitFullscreen)return t.msExitFullscreen()}return!1}e.mix(e.Node.DOM_EVENTS,{fullscreenchange:!0,webkitfullscreenchange:!0,mozfullscreenchange:!0,MSFullscreenChange:!0}),e.namespace("fluid").Fullscreen=function(){this.fullscreenChangeHandler=e.on("fullscreenchange",this.handleFullscreenChange.bind(this)),this.webkitFullscreenChangeHandler=e.on("webkitfullscreenchange",this.handleFullscreenChange.bind(this)),this.mozFullscreenChangeHandler=e.on("mozfullscreenchange",this.handleFullscreenChange.bind(this)),this.msFullscreenChangeHandler=e.on("MSFullscreenChange",this.handleFullscreenChange.bind(this)),this.publish("enterFullscreen"),this.publish("exitFullscreen")},e.fluid.Fullscreen.prototype={isFullscreenCapable:r,isInFullscreenMode:s,enterFullscreen:i,exitFullscreen:o,handleFullscreenChange:n,destroy:t},e.augment(e.fluid.Fullscreen,e.EventTarget,!0,null,{prefix:"fullscreen"})},"@VERSION@",{requires:["event-custom"],optional:[],affinity:"client"});
YUI.add("fluid-magic-slideshow-view",function(e){e.namespace("Views")[this.name]=e.Base.create("fluid-magic-slideshow-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){return this.nsid=t.nsid,this.modelParams=t.photoListConfig.modelParams,this.pageParams=t.pageParams,this.modelParams.fetchParams&&(this.pageParams=e.merge(this.modelParams.fetchParams,this.pageParams)),this.pageParams.viewPageSize?this.positionMultipler=this.pageParams.viewPageSize:this.positionMultipler=this.pageParams.perPage,this},loadState:function(){var e=this;return this.appContext.getModel(this.modelParams.registryName,this.modelParams.modelIdOrAttributes,this.modelParams.fetchParams).then(function(t){e.position=(e.pageParams.nominalPage-1)*e.positionMultipler||0,e.collection=t.getValue("photoPageList"),e.isEnabled=e.collection.totalItems>0}).catch(function(e){})},buildContainer:function(){return this.setContainerHTML(this.templates("fluid-magic-slideshow")({isEnabled:this.isEnabled})),this},toggleSlideshow:function(t){var n;e.rapidTracker.beacon(this.name,"launchSlideshow"),t.halt(),n=new e.Views.Slideshow({appContext:this.appContext,collection:this.collection,pageParams:this.pageParams,position:this.position}),n.show()},activate:function(){return this.isEnabled&&this.registerEventHandler(this.get("container").one(".slideshow-toggle").on("click",this.toggleSlideshow.bind(this))),this}})},"@VERSION@",{requires:["flickr-view","flickr-promise","hermes-template-fluid-magic-slideshow","fluid-magic-tools-css","slideshow-view"],langBundles:["common"]});
YUI.add("hermes-template-photostream-filter-tools",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function l(e,t){var r="",i;return r+='\n<div class="dropdown-link filter-view"><p>',(i=n.filterValue)?i=i.call(e,{hash:{},data:t}):(i=e.filterValue,i=typeof i===u?i.apply(e):i),r+=a(i)+"</p><span></span></div>\n",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression,f=this;s+='<div class="dropdown-link filter-sort"><p>',(o=n.sortValue)?o=o.call(t,{hash:{},data:i}):(o=t.sortValue,o=typeof o===u?o.apply(t):o),s+=a(o)+"</p><span></span></div>\n",o=n["if"].call(t,t.viewingSelf,{hash:{},inverse:f.noop,fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;return s+="\n\n",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/photostream-filter-tools",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("photostream-filter-tools-view",function(e){var t={css:{filterView:".filter-view",filterSort:".filter-sort",help:".filter-helper .filter-helper-icon"}},n={me:"filter-bar.VIEW_ALL",fr:"filter-bar.FRIEND",fa:"filter-bar.FAMILY",ff:"filter-bar.FRIEND_AND_FAMILY",pu:"filter-bar.PUBLIC",dt:"cameraroll.DATE_TAKEN",dc:"cameraroll.DATE_UPLOADED"};e.namespace("Views")[this.name]=e.Base.create("photostream-filter-tools-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.nsid=e.nsid,this.set("viewingSelf",this.appContext.getViewer().nsid===this.nsid),this},loadState:function(){var t=this,n=[];return this.appContext.getViewer().signedIn&&n.push(this.appContext.getModel("person-preferences-models",this.appContext.getViewer().nsid).then(function(n){t.set("personPreferenceModel",n),t.set("filterValue",e.Models["person-preferences-models"].getReadablePrefName(n.getValue("photostreamViewAsPref"))),t.set("sortValue",e.Models["person-preferences-models"].getReadablePrefName(n.getValue("photostreamViewOrderPref")))})),e.Promise.all(n)},buildContainer:function(){var e=this.get("personPreferenceModel");return this.setContainerHTML(this.templates("photostream-filter-tools")({viewingSelf:this.get("viewingSelf"),sortValue:this.intlMessage({intlName:n[e.getValue("photostreamViewOrderPref")]}),filterValue:this.intlMessage({intlName:n[e.getValue("photostreamViewAsPref")]})})),this},activate:function(){return this.get("viewingSelf")&&this.registerEventHandler(this.get("container").one(t.css.filterView).on("click",this.handleFilterView.bind(this))),this.registerEventHandler(this.get("container").one(t.css.filterSort).on("click",this.handleFilterSort.bind(this))),this},handleFilterSort:function(t){t.halt();var n=this;this.dropdown=new e.Views.FluidDroparound({appContext:this.appContext,showDropArrow:!0,observePageResize:!0,anchorElement:t.target.one("span"),minVerticalSpace:400,positionFixed:!0,preferLeft:!0,closeOnScroll:!0,anchorOffsetHorizontal:11,menuItems:[{text:this.intlMessage({intlName:"cameraroll.DATE_UPLOADED"}),data:"dateposted"},{text:this.intlMessage({intlName:"cameraroll.DATE_TAKEN"}),data:"datetaken"}]}),this.dropdown.show(),this.registerEventHandler(this.dropdown.on("selected",function(e){e&&e.menuItem&&(n.get("container").one(".filter-sort p").set("text",e.menuItem.text),n.set("sortValue",e.menuItem.data),n.notifyPhotostreamToUpdate()),n.dropdown.close()}),this)},handleFilterView:function(t){t.halt();var n=this;this.dropdown=new e.Views.FluidDroparound({appContext:this.appContext,showDropArrow:!0,observePageResize:!0,anchorElement:t.target.one("span"),minVerticalSpace:400,preferLeft:!0,closeOnScroll:!0,anchorOffsetHorizontal:11,positionFixed:!0,menuItems:[{text:this.intlMessage({intlName:"filter-bar.PUBLIC"}),data:"public"},{text:this.intlMessage({intlName:"filter-bar.FRIEND"}),data:"friend"},{text:this.intlMessage({intlName:"filter-bar.FAMILY"}),data:"family"},{text:this.intlMessage({intlName:"filter-bar.FRIEND_AND_FAMILY"}),data:"ff"},{text:this.intlMessage({intlName:"filter-bar.VIEW_ALL"}),data:"me"}]}),this.dropdown.show(),this.registerEventHandler(this.dropdown.on("selected",function(e){e&&e.menuItem&&(n.get("container").one(".filter-view p").set("text",e.menuItem.text),n.set("filterValue",e.menuItem.data),n.notifyPhotostreamToUpdate()),n.dropdown.close()}),this)},notifyPhotostreamToUpdate:function(){var t=this;this.get("personPreferenceModel").setValues({photostreamViewAsPref:e.Models["person-preferences-models"].PHOTOSTREAM_VIEW_AS_TYPES[this.get("filterValue")],photostreamViewOrderPref:e.Models["person-preferences-models"].PHOTOSTREAM_VIEW_ORDER_TYPES[this.get("sortValue")]}),e.loaderBar.start(),this.get("personPreferenceModel").remoteUpdate().then(function(){t.fire("subviewViewEvent","photostream:filter",{filterValue:t.get("filterValue"),sortValue:t.get("sortValue")})})}},{ATTRS:{filterValue:{value:"me"},sortValue:{value:"dateposted"}}})},"@VERSION@",{requires:["flickr-view","flickr-promise","fluid-droparound-view","hermes-template-photostream-filter-tools","loader-bar"],langBundles:["cameraroll","filter-bar"]});
YUI.add("hermes-template-fluid-magic-tools",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function h(e,t){var r="",i,s;return r+='\n		<div class="share-link">\n			',s={hash:{},data:t},r+=l((i=n.outlet||e.outlet,i?i.call(e,e.shareView,s):f.call(e,"outlet",e.shareView,s)))+"\n		</div>\n		",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression,c=this;s+='<div class="fluid-centered fluid-magic-toolbar">\n	',a={hash:{},data:i},s+=l((o=n.outlet||t.outlet,o?o.call(t,t["photostream-filter-tools-view"],a):f.call(t,"outlet",t["photostream-filter-tools-view"],a)))+'\n\n	<div class="secondary-tools">\n		',u=n["if"].call(t,t.shareView,{hash:{},inverse:c.noop,fn:c.program(1,h,i),data:i});if(u||u===0)s+=u;return s+="\n		",a={hash:{},data:i},s+=l((o=n.outlet||t.outlet,o?o.call(t,t["fluid-magic-slideshow-view"],a):f.call(t,"outlet",t["fluid-magic-slideshow-view"],a)))+"\n		",a={hash:{},data:i},s+=l((o=n.outlet||t.outlet,o?o.call(t,t["fluid-magic-search-view"],a):f.call(t,"outlet",t["fluid-magic-search-view"],a)))+"\n\n	</div>\n</div>\n",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/fluid-magic-tools",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("fluid-magic-tools-view",function(e){e.namespace("Views")[this.name]=e.Base.create("fluid-magic-tools-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.set("selected",""),this.set("isEmptyPage",e.isEmptyPage),e.subnavConfig&&e.subnavConfig.selected&&this.set("selected",e.subnavConfig.selected),this},subviewConfig:{"fluid-share-photostream-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!1,parentViewName:this.name,disabled:function(){return this.get("selected")!=="photostream"}},"fluid-share-favorites-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!1,parentViewName:this.name,disabled:function(){return this.get("selected")!=="favorites"}},"photostream-filter-tools-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,disabled:function(){return this.get("selected")!=="photostream"||!this.appContext.getViewer().signedIn},additionalViewClasses:["primary-tools"]},"fluid-magic-search-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,disabled:function(){return!!this.get("isEmptyPage")},additionalViewClasses:["closed"]},"fluid-magic-slideshow-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,disabled:function(){return!!this.get("isEmptyPage")}}},loadState:function(){return e.Promise.resolve()},buildContainer:function(){return this.setContainerHTML(this.templates("fluid-magic-tools")({shareView:this.getShareViewContainer(),"fluid-magic-search-view":this.subviews["fluid-magic-search-view"]?this.subviews["fluid-magic-search-view"].get("container"):"","fluid-magic-slideshow-view":this.subviews["fluid-magic-slideshow-view"]?this.subviews["fluid-magic-slideshow-view"].get("container"):"","photostream-filter-tools-view":this.subviews["photostream-filter-tools-view"]?this.subviews["photostream-filter-tools-view"].get("container"):""})),this},activate:function(){return this},getShareViewContainer:function(){var e="";return this.subviews["fluid-share-"+this.get("selected")+"-view"]&&(e=this.subviews["fluid-share-"+this.get("selected")+"-view"].get("container")),e}},{ATTRS:{}})},"@VERSION@",{requires:["flutil","flickr-view","flickr-promise","fluid-share-photostream-view","fluid-share-favorites-view","fluid-magic-slideshow-view","photostream-filter-tools-view","hermes-template-fluid-magic-tools","fluid-magic-tools-css","fluid-magic-search-css"],optional:[],langBundles:["share-modal","common"]});
