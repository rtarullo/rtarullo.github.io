YUI.add("hermes-template-fluid-magic-search",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function h(e,t){var r,i,s;return s={hash:{},inverse:c.program(4,d,t),fn:c.program(2,p,t),data:t},i=(r=n.ifCond||e.ifCond,r?r.call(e,e.pageType,"===","photostream",s):f.call(e,"ifCond",e.pageType,"===","photostream",s)),i||i===0?i:""}function p(e,t){var r,i;return i={hash:{intlName:"search.SEARCH_PHOTOSTREAM"},data:t},l((r=n.intlMessage||e.intlMessage,r?r.call(e,i):f.call(e,"intlMessage",i)))}function d(e,t){var r,i;return i={hash:{intlName:"search.SEARCH_FAVORITES"},data:t},l((r=n.intlMessage||e.intlMessage,r?r.call(e,i):f.call(e,"intlMessage",i)))}function v(e,t){var r,i;return i={hash:{intlName:"search.TOGGLE_SEARCH"},data:t},l((r=n.intlMessage||e.intlMessage,r?r.call(e,i):f.call(e,"intlMessage",i)))}function m(e,t){var r="",i,s,o;r+='"',o={hash:{},inverse:c.program(11,y,t),fn:c.program(9,g,t),data:t},s=(i=n.ifCond||e.ifCond,i?i.call(e,e.pageType,"===","photostream",o):f.call(e,"ifCond",e.pageType,"===","photostream",o));if(s||s===0)r+=s;return r}function g(e,t){return' data-track="addContextPhotostream"'}function y(e,t){return' data-track="addContextFaves"'}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression,c=this;s+='<a href="#" class="search-toggle" title="',a={hash:{},inverse:c.program(6,v,i),fn:c.program(1,h,i),data:i},u=(o=n.isFlipped||t.isFlipped,o?o.call(t,t.flippers,"enable-new-autosuggest",a):f.call(t,"isFlipped",t.flippers,"enable-new-autosuggest",a));if(u||u===0)s+=u;s+='"',a={hash:{},inverse:c.noop,fn:c.program(8,m,i),data:i},u=(o=n.isFlipped||t.isFlipped,o?o.call(t,t.flippers,"enable-new-autosuggest",a):f.call(t,"isFlipped",t.flippers,"enable-new-autosuggest",a));if(u||u===0)s+=u;s+='><span></span></a>\n<input class="magic-search" placeholder="',a={hash:{},inverse:c.program(4,d,i),fn:c.program(2,p,i),data:i},u=(o=n.ifCond||t.ifCond,o?o.call(t,t.pageType,"===","photostream",a):f.call(t,"ifCond",t.pageType,"===","photostream",a));if(u||u===0)s+=u;return s+='" type="text" value=""></input>\n',s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/fluid-magic-search",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("fluid-magic-search-view",function(e){var t="photostream",n="favorites";e.namespace("Views")[this.name]=e.Base.create("fluid-magic-search-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.nsid=e.nsid,this.selected=e.subnavConfig?e.subnavConfig.selected:"",this},loadState:function(){return this.appContext.getModel("person-models",this.nsid).then(function(e){this.set("personModel",e)}.bind(this))},buildContainer:function(){return this.setContainerHTML(this.templates("fluid-magic-search")({pageType:this.selected})),this},handleSearchContextRemoval:function(){this.get("container").one(".search-toggle > span").removeClass("active")},activate:function(){var t=this.get("container").one(".magic-search");return t&&(this.registerEventHandler(this.get("container").one(".search-toggle").on("click",this.toggleSearch.bind(this))),this.registerEventHandler(t.on("keyup",this.performSearch.bind(this)))),this.appContext.flipper.isFlipped("enable-search-pills")&&this.registerEventHandler(e.on("remove-context-in-search-field",this.handleSearchContextRemoval.bind(this))),this},toggleSearch:function(t){var n=this.get("container");t.halt(),this.appContext.flipper.isFlipped("enable-search-pills")?(e.fire("add-context-to-search-field",{name:this.get("personModel").getValue("displayname"),id:this.nsid,type:"user",scope:this.selected}),t.target.addClass("active")):n.hasClass("closed")?(n.removeClass("closed"),n.one(".magic-search").focus()):n.addClass("closed")},performSearch:function(r){var i=this.get("container").one(".magic-search").get("value"),s;if(r.keyCode&&r.keyCode!==13)return;r.halt(),this.selected===t?s=new e.SearchUrl({userId:this.nsid,view_all:1},this.appContext,e.SearchUrl.searchTypes.PHOTOS):this.selected===n&&(this.nsid===this.appContext.getViewer().nsid?s=new e.SearchUrl({faves:1,view_all:1},this.appContext,e.SearchUrl.searchTypes.PHOTOS):s=new e.SearchUrl({userId:this.nsid,faves:1,view_all:1},this.appContext,e.SearchUrl.searchTypes.PHOTOS)),s.setSearchTerm(i),this.appContext.flapp.navigate(s.getURL())}})},"@VERSION@",{requires:["flickr-view","flickr-promise","fluid-droparound-view","hermes-template-fluid-magic-search","search-url"],langBundles:["common","search","fluid-toolbar"]});
